<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.scut.onlinebookstore.dao.BookDao">
    <resultMap id="orderMap" type="com.scut.onlinebookstore.models.Order">
        <id column="orderId" property="orderId" />
        <result column="name" property="name" />
        <result column="userId" property="userId" />
        <result column="totalPrice" property="totalPrice" />
        <result column="status" property="status" />
        <result column="orderTime" property="orderTime" />
        <result column="isCanceled" property="isCanceled" />
    </resultMap>
    
    <resultMap id="orderItemMap" type="com.scut.onlinebookstore.models.OrderItem">
        <id column="orderId" property="orderId" />
        <id column="bookISBN" property="bookISBN" />
        <result column="count" property="count" />
    </resultMap>

	<insert id="createOrder">
        INSERT INTO Book(orderId,  userId,  totalPrice,  status,  orderTime,  isCanceled)
        VALUES (#{0},#{1},#{2},#{3},#{4},#{5})
    </insert>
    
    <select id="findByUser" parameterType="Integer" resultMap="orderMap">
        SELECT * FROM Order WHERE userId=#{userId}
    </select>
    
    <select id="findById" resultMap="orderItemMap">
        SELECT * FROM Order WHERE orderId=#{orderId}
    </select>  
    
    <update id="updateStatus">
        UPDATE Order
        <set>
            status=#{1}+1
        </set>
        WHERE orderId=#{0} and status=#{1}
    </update>
    
    <update id="cancel" parameterType="Integer">
        UPDATE Order
        <set>
            status=-1
        </set>
        WHERE orderId=#{orderId}
    </update> 

</mapper>